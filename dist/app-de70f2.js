!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,i){"use strict";e.a="https://qq-music-api.now.sh";e.c="https://qq-music-api.now.sh/top";e.b="https://qq-music-api.now.sh/search"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(2),n=(i.n(s),i(3)),r=i(5),a=i(6),l=i(8),h=i(9);new r.a({tab:document.querySelector(".nav"),container:document.querySelector(".container")}),new n.a(document.querySelector("#rec-view")),new a.a(document.querySelector("#ranking-view")),new l.a(document.querySelector("#search-view"));let o=new h.a(document.querySelector("#player-view"));document.querySelector("#player").addEventListener("click",()=>{console.log("show the player"),o.show()});window.addEventListener("hashchange",function(t){let e=window.location.hash,i={},s=!!/^(#player\?)/.test(e)&&e.replace(/^(#player\?)/,"").split("&");s?(s.map(t=>{i[t.replace(/=.+/,"")]=t.replace(/.+=/,"")}),o.play(i)):o.hide()})},function(t,e){},function(t,e,i){"use strict";var s=i(0),n=i(4);e.a=class{constructor(t){this.wrap=t,this.getData()}getData(){fetch(s.a).then(t=>t.json()).then(t=>this.data=t.data).then(()=>this.render())}render(){this.sliderRender(this.data.slider),this.radioRender(this.data.radioList),this.songListRender(this.data.songList)}sliderRender(t){let e=t.map(t=>({link:t.linkUrl.replace("http://","https://"),image:t.picUrl.replace("http://","https://")}));new n.a({el:this.wrap.querySelector("#slider"),data:e})}radioRender(t){this.wrap.querySelector("#radio-list").innerHTML=t.map(t=>`<li class="list-item">\n                <a href="javascript:;" class="listmain">\n                    <div class="list-media">\n                        <img src=${t.picUrl}>\n                        <span></span>\n                    </div>\n                    <div class="list-desc">\n                        <h3 class="list-title">${t.Ftitle}</h3>\n                    </div>\n                </a>\n            </li>`).join("")}songListRender(t){this.wrap.querySelector("#list-wrap").innerHTML=t.map(t=>`<li class="list-item">\n                <div class="list-media">\n                    <a href="https://y.qq.com/n/yqq/playlist/${t.id}.html">\n                        <img src="${t.picUrl.replace("http://","https://")}" alt="#">\n                    </a>\n                </div>\n                <div class="list-desc">\n                <h4 class="list-title">${t.songListDesc}</h4>\n                </div>\n            </li>`).join("")}}},function(t,e,i){"use strict";e.a=class{constructor(t={}){this.el=t.el,this.data=t.data,this.interval=t.interval||2500,this.index=0,this.render(),this.start()}render(){let t=this.data;this.el.innerHTML=' <ul class="slider-wrap"> </ul> ',this.wrap=this.el.firstElementChild,this.wrap.style.width=`${100*this.data.length}%`,this.wrap.innerHTML=t.map(t=>`<li class="item">\n                    <a href="${t.link}">\n                    <img src="${t.image}" alt=""></a>\n                </li>`).join("")}start(){setInterval(this.next.bind(this),this.interval)}next(){this.index===this.data.length-1?this.index=0:this.index+=1;let t=`-${100*this.index/this.data.length}%`;this.wrap.style.transform=`translateX(${t})`}}},function(t,e,i){"use strict";e.a=class{constructor(t={}){this.tabHeader=t.tab.querySelectorAll(".nav a"),this.tabContainer=t.container.children,this.bind()}bind(){var t=this;this.tabHeader.forEach(function(e){e.onclick=function(e){var i=e.target,s=Array().indexOf.call(t.tabHeader,i);t.tabHeader.forEach(function(t){t.classList.remove("current")}),Array.prototype.forEach.call(t.tabContainer,function(t){t.classList.remove("current")}),i.classList.add("current"),t.tabContainer[s].classList.add("current"),window.dispatchEvent(new Event("scroll"))}})}}},function(t,e,i){"use strict";var s=i(0),n=i(7);e.a=class{constructor(t){this.el=t,this.getData()}getData(){fetch(s.c).then(t=>t.json()).then(t=>this.data=t.data.topList).then(()=>this.render())}render(){this.el.querySelector(".ranking-list").innerHTML=this.data.map(t=>`<li class="ranking-item">\n                <div class="main">\n                    <a href="#" >\n                        <img class="lazyload" src="#" data-url="${t.picUrl.replace("http://","https://")}">\n                        <span class="count">${(t.listenCount/1e3).toFixed(1)}万</span>\n                    </a>\n                </div>\n                <div class="info">\n                    <h3>${t.topTitle}</h3>\n                    ${this.songName(t.songList)}\n                </div>\n            </li>`).join(""),new n.a(this.el.querySelectorAll(".ranking-list img"))}songName(t){return t.map((t,e)=>`<p>\n            <i>${e+1}</i>\n            <span>${t.songname}</span><i>- ${t.singername}</i>\n            </p>`).join("")}}},function(t,e,i){"use strict";e.a=class{constructor(t){this.el=t,this.pre,this.timer,window.addEventListener("scroll",()=>this.throttle(this.checkShow,this,300))}throttle(t,e,i){let s=+new Date,n=s-this.pre;!this.pre||n>=i?(t.call(e),this.pre=s):this.pre&&n<i&&(clearTimeout(this.timer),this.timer=setTimeout(()=>t.call(e),i))}checkShow(){this.imgs=[].slice.call(document.querySelectorAll(".lazyload")),this.imgs.map(t=>{this.isVisible(t)&&(t.src=t.dataset.url,t.classList.remove("lazyload"))})}isVisible(t){let{top:e,left:i,right:s,bottom:n}=t.getBoundingClientRect(),r=document.documentElement.clientWidth,a=document.documentElement.clientHeight;return(e>0&&e<a||n>0&&n<a)&&(i>0&&i<r||s>0&&s<r)}}},function(t,e,i){"use strict";var s=i(0);e.a=class{constructor(t){this.el=t,this.input=this.el.querySelector("#input"),this.songs=this.el.querySelector(".song-list"),this.input.addEventListener("keyup",this.onKeyUp.bind(this)),this.keyWord,this.page=1,this.curpage=20,this.nomore=!1,this.isload=!1,this._onscroll=this.onscroll.bind(this),window.addEventListener("scroll",this._onscroll)}onKeyUp(t){let e=t.target.value.trim();if(this.keyWord=e,!e)return this.reset();"Enter"===t.key&&this.search(e)}onscroll(t){if(!this.nomore&&document.documentElement.clientHeight+pageYOffset>document.body.scrollHeight-50){if(!this.keyWord)return this.reset();this.search(this.keyWord,this.page+1)}}search(t,e){this.isload||(this.isload=!0,fetch(`${s.b}?keyword=${t}&page=${e||this.page}`).then(t=>t.json()).then(t=>(this.page=t.data.semantic.curpage,this.nomore="no results"===t.message,t.data)).then(t=>this.render(t)).then(()=>this.isload=!1).catch(()=>this.isload=!1))}render(t){this.songs.innerHTML+=t.song.list.map(t=>{let e=t.singer.map(t=>t.name);return`<li class="song-item">\n            <a href="#player?singer=${e}&songname=${t.songname}&songid=${t.songid}&albummid=${t.albummid}&duration=${t.interval}">\n            <i class="icon"></i>\n            <h6 class="song-name">${t.songname}</h6>\n            <p class="song-artist">${e}</p>\n            </a>\n         </li>`}).join("")}reset(){this.page=1,this.curpage=20,this.songs.innerHTML=""}}},function(t,e,i){"use strict";var s=i(10),n=i(11),r=i(12);e.a=class{constructor(t){this.el=t,this.el.addEventListener("click",t=>this.event(t)),this.audio=this.createAudio(),this.progress=new n.a(this.el.querySelector("#progress")),this.lyric=new r.a(this.el.querySelector("#lyric-text"),this.audio),this.fetching=!1}play(t={}){let e=Object(s.c)(t.songid),i=Object(s.a)(t.albummid);this.el.querySelector(".song-name").innerHTML=t.songname,this.el.querySelector(".singer-name").innerHTML=t.singer,this.el.querySelector(".album-cover").src=i,this.el.querySelector(".bg-blur").style.backgroundImage=`url(${i})`,this.fetching||(this.audio.src=e,this.progress.init(t.duration),fetch(Object(s.b)(t.songid)).then(t=>t.json()).then(t=>t.lyric).then(t=>this.lyric.init(t)).catch(()=>{console.log("something wrong")}).then(()=>this.fetching=!1),this.audio.play(),this.audio.volume=.3,this.show())}createAudio(){let t=document.createElement("audio");return t.addEventListener("ended",()=>{this.audio.play(),this.progress.init(),this.lyric.reset()}),document.body.appendChild(t),t}event(t){let e=t.target;switch(e.id){case"pause-btn":this.onPause(e);break;case"play-btn":this.onPlay(e);break;case"hide-btn":this.hide()}}onPlay(t){t.id="pause-btn",t.classList.remove("icon-play"),t.classList.add("icon-pause"),this.audio.play(),console.log("继续播放"),this.progress.play(),this.lyric.start()}onPause(t){t.id="play-btn",t.classList.remove("icon-pause"),t.classList.add("icon-play"),this.audio.pause(),console.log("暂停播放"),this.progress.pause(),this.lyric.pause()}show(){this.el.classList.add("show")}hide(){this.el.classList.remove("show")}}},function(t,e,i){"use strict";e.c=function(t){return`http://ws.stream.qqmusic.qq.com/${t}.m4a?fromtag=46`},e.b=function(t){return`https://qq-music-api.now.sh/lyrics?id=${t}`},e.a=function(t){return`https://y.gtimg.cn/music/photo_new/T002R150x150M000${t}.jpg`}},function(t,e,i){"use strict";e.a=class{constructor(t){this.el=t,this.progressLoad=this.el.querySelector(".progress-load"),this.elapsed=this.el.querySelector(".elapsed-time"),this.duration=this.el.querySelector(".duration-time"),this.elapsedTime=0,this.durationTime=0,this.translate=0}init(t){clearInterval(this.intervalId),this.elapsedTime=0,this.progressLoad.style.transform="translateX(-100%)",t&&(this.durationTime=t,this.duration.innerHTML=this.formatTime(t)),this.intervalId=setInterval(this.update.bind(this),100)}update(t){this.elapsedTime>=this.durationTime&&this.init(),this.elapsedTime+=.1,this.elapsed.innerHTML=this.formatTime(this.elapsedTime);let e=this.elapsedTime/this.durationTime*100-100;this.progressLoad.style.transform=`translateX(${e}%)`}pause(){clearInterval(this.intervalId)}play(){this.intervalId=setInterval(this.update.bind(this),100)}formatTime(t){let e=Math.floor(t/60),i=Math.floor(t%60);return e<10&&(e="0"+e),i<10&&(i="0"+i),`${e}:${i}`}}},function(t,e,i){"use strict";e.a=class{constructor(t,e,i){this.el=t,this.audio=e,this.lyric="",this.index=0,this.lineHeight=i||42}init(t){this.lyric=this.formatText(t).match(/^\[\d{2}:\d{2}.\d{2}\](.+)$/gm),this.render(this.lyric)}reset(){this.index=0,this.el.style.transform="translateY(0px)",this.update()}update(){this.fn=function(){for(let t=this.index;t<this.lyricline.length;t++)Math.floor(this.audio.currentTime)===+this.lyricline[t].attributes["data-time"].value&&(this.lyricline[t].classList.add("lyric-current"),this.index=t,this.lyricline[t].previousElementSibling&&this.lyricline[t].previousElementSibling.classList.remove("lyric-current"));if(this.index>=4){const t=-(this.index-3)*this.lineHeight;this.el.style.transform=`translateY(${t}px)`}},this.audio.addEventListener("timeupdate",()=>this.throttle(this.fn,this,500))}start(){this.audio.addEventListener("timeupdate",()=>this.throttle(this.fn,this,500))}pause(){this.audio.removeEventListener("timeupdate",()=>this.throttle(this.fn,this,500))}render(t){let e=t.map(t=>`<p data-time="${this.getTimePoint(t.slice(1,9))}">${t.slice(10)}</p>\n        `).join("");this.el.innerHTML=e,this.lyricline=this.el.querySelectorAll("p"),this.update()}getTimePoint(t){return t.replace(/(\d{2}):(\d{2}).\d{2}/,(t,e,i)=>60*+e+ +i)}formatText(t){let e=document.createElement("div");return e.innerHTML=t,e.innerText}throttle(t,e,i){let s=+new Date,n=s-this.pre;!this.pre||n>=i?(t.call(e),this.pre=s):this.pre&&n<i&&(clearTimeout(this.timer),this.timer=setTimeout(()=>t.call(e),i))}}}]);