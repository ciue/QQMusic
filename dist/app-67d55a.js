!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RECOMMEND_URL="https://qq-music-api.now.sh",t.TOPLIST_URL="https://qq-music-api.now.sh/top",t.SEARCH_URL="https://qq-music-api.now.sh/search",t.LYRICS_URL="https://qq-music-api.now.sh/lyrics"},function(e,t,n){"use strict";n(2);var i=n(3),r=n(5),a=n(6),s=n(8),o=n(9);new r.TabSwitch({tab:document.querySelector(".nav"),container:document.querySelector(".container")}),new i.Recommend(document.querySelector("#rec-view")),new a.Ranking(document.querySelector("#ranking-view")),new s.Search(document.querySelector("#search-view"));var l=new o.Music_player(document.querySelector("#player-view"));document.querySelector("#player").addEventListener("click",function(){console.log("show the player"),l.show()});window.addEventListener("hashchange",function(e){var t=window.location.hash,n={},i=!!/^(#player\?)/.test(t)&&t.replace(/^(#player\?)/,"").split("&");i?(i.map(function(e){n[e.replace(/=.+/,"")]=e.replace(/.+=/,"")}),l.play(n)):l.hide()})},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Recommend=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),a=n(4);t.Recommend=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wrap=t,this.getData()}return i(e,[{key:"getData",value:function(){var e=this;fetch(r.RECOMMEND_URL).then(function(e){return e.json()}).then(function(t){return e.data=t.data}).then(function(){return e.render()})}},{key:"render",value:function(){this.sliderRender(this.data.slider),this.radioRender(this.data.radioList),this.songListRender(this.data.songList)}},{key:"sliderRender",value:function(e){var t=e.map(function(e){return{link:e.linkUrl.replace("http://","https://"),image:e.picUrl.replace("http://","https://")}});new a.Slider({el:this.wrap.querySelector("#slider"),data:t})}},{key:"radioRender",value:function(e){this.wrap.querySelector("#radio-list").innerHTML=e.map(function(e){return'<li class="list-item">\n                <a href="javascript:;" class="listmain">\n                    <div class="list-media">\n                        <img src='+e.picUrl.replace("http://","https://")+'>\n                        <span></span>\n                    </div>\n                    <div class="list-desc">\n                        <h3 class="list-title">'+e.Ftitle+"</h3>\n                    </div>\n                </a>\n            </li>"}).join("")}},{key:"songListRender",value:function(e){this.wrap.querySelector("#list-wrap").innerHTML=e.map(function(e){return'<li class="list-item">\n                <div class="list-media">\n                    <a href="https://y.qq.com/n/yqq/playlist/'+e.id+'.html">\n                        <img src="'+e.picUrl.replace("http://","https://")+'" alt="#">\n                    </a>\n                </div>\n                <div class="list-desc">\n                <h4 class="list-title">'+e.songListDesc+"</h4>\n                </div>\n            </li>"}).join("")}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Slider=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t.el,this.data=t.data,this.interval=t.interval||2500,this.index=0,this.render(),this.start()}return i(e,[{key:"render",value:function(){var e=this.data;this.el.innerHTML=' <ul class="slider-wrap"> </ul> ',this.wrap=this.el.firstElementChild,this.wrap.style.width=100*this.data.length+"%",this.wrap.innerHTML=e.map(function(e){return'<li class="item">\n                    <a href="'+e.link+'">\n                    <img src="'+e.image+'" alt=""></a>\n                </li>'}).join("")}},{key:"start",value:function(){setInterval(this.next.bind(this),this.interval)}},{key:"next",value:function(){this.index===this.data.length-1?this.index=0:this.index+=1;var e="-"+100*this.index/this.data.length+"%";this.wrap.style.transform="translateX("+e+")"}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.TabSwitch=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tabHeader=t.tab.querySelectorAll(".nav a"),this.tabContainer=t.container.children,this.bind()}return i(e,[{key:"bind",value:function(){var e=this;Array.prototype.forEach.call(this.tabHeader,function(t){t.onclick=function(t){var n=t.target,i=Array().indexOf.call(e.tabHeader,n);Array.prototype.forEach.call(e.tabHeader,function(e){e.classList.remove("current")}),Array.prototype.forEach.call(e.tabContainer,function(e){e.classList.remove("current")}),n.classList.add("current"),e.tabContainer[i].classList.add("current"),window.dispatchEvent(new Event("scroll"))}})}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ranking=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),a=n(7);t.Ranking=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.getData()}return i(e,[{key:"getData",value:function(){var e=this;fetch(r.TOPLIST_URL).then(function(e){return e.json()}).then(function(t){return e.render(t.data.topList)})}},{key:"render",value:function(e){var t=this;this.el.querySelector(".ranking-list").innerHTML=e.map(function(e){return'<li class="ranking-item">\n                <div class="main">\n                    <a href="#" >\n                        <img class="lazyload" src="#" data-url="'+e.picUrl.replace("http://","https://")+'">\n                        <span class="count">'+(e.listenCount/1e3).toFixed(1)+'万</span>\n                    </a>\n                </div>\n                <div class="info">\n                    <h3>'+e.topTitle+"</h3>\n                    "+t.songName(e.songList)+"\n                </div>\n            </li>"}).join(""),new a.LazyLoad(this.el.querySelectorAll(".ranking-list img"))}},{key:"songName",value:function(e){return e.map(function(e,t){return"<p>\n            <i>"+(t+1)+"</i>\n            <span>"+e.songname+"</span><i>- "+e.singername+"</i>\n            </p>"}).join("")}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.LazyLoad=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.pre,this.timer,window.addEventListener("scroll",function(){return n.throttle(n.checkShow,n,300)})}return i(e,[{key:"throttle",value:function(e,t,n){var i=+new Date,r=i-this.pre;!this.pre||r>=n?(e.call(t),this.pre=i):this.pre&&r<n&&(clearTimeout(this.timer),this.timer=setTimeout(function(){return e.call(t)},n))}},{key:"checkShow",value:function(){var e=this;this.imgs=[].slice.call(document.querySelectorAll(".lazyload")),this.imgs.map(function(t){e.isVisible(t)&&(t.src=t.dataset.url,t.classList.remove("lazyload"))})}},{key:"isVisible",value:function(e){var t=e.getBoundingClientRect(),n=t.top,i=t.left,r=t.right,a=t.bottom,s=document.documentElement.clientWidth,o=document.documentElement.clientHeight;return(n>0&&n<o||a>0&&a<o)&&(i>0&&i<s||r>0&&r<s)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Search=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0);t.Search=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.input=this.el.querySelector("#input"),this.songs=this.el.querySelector(".song-list"),this.input.addEventListener("keyup",this.onKeyUp.bind(this)),this.keyWord,this.page=1,this.curpage=20,this.nomore=!1,this.isload=!1,this._onscroll=this.onscroll.bind(this),window.addEventListener("scroll",this._onscroll)}return i(e,[{key:"onKeyUp",value:function(e){var t=e.target.value.trim();if(this.keyWord=t,!t)return this.reset();"Enter"===e.key&&this.search(t)}},{key:"onscroll",value:function(e){if(!this.nomore&&document.documentElement.clientHeight+pageYOffset>document.body.scrollHeight-50){if(!this.keyWord)return this.reset();this.search(this.keyWord,this.page+1)}}},{key:"search",value:function(e,t){var n=this;this.isload||(this.isload=!0,fetch(r.SEARCH_URL+"?keyword="+e+"&page="+(t||this.page)).then(function(e){return e.json()}).then(function(e){return n.page=e.data.semantic.curpage,n.nomore="no results"===e.message,e.data}).then(function(e){return n.render(e)}).then(function(){return n.isload=!1}).catch(function(){return n.isload=!1}))}},{key:"render",value:function(e){this.songs.innerHTML+=e.song.list.map(function(e){var t=e.singer.map(function(e){return e.name});return'<li class="song-item">\n            <a href="#player?singer='+t+"&songname="+e.songname+"&songid="+e.songid+"&albummid="+e.albummid+"&duration="+e.interval+'">\n            <i class="icon"></i>\n            <h6 class="song-name">'+e.songname+'</h6>\n            <p class="song-artist">'+t+"</p>\n            </a>\n         </li>"}).join("")}},{key:"reset",value:function(){this.page=1,this.curpage=20,this.songs.innerHTML=""}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Music_player=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(10),a=n(11),s=n(12);t.Music_player=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.el.addEventListener("click",function(e){return n.event(e)}),this.audio=this.createAudio(),this.progress=new a.Progress(this.el.querySelector("#progress")),this.lyric=new s.Lyric(this.el.querySelector("#lyric-text"),this.audio),this.fetching=!1}return i(e,[{key:"play",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,r.songUrl)(t.songid),i=(0,r.albumCoverUrl)(t.albummid);this.el.querySelector(".song-name").innerHTML=t.songname,this.el.querySelector(".singer-name").innerHTML=t.singer,this.el.querySelector(".album-cover").src=i,this.el.querySelector(".bg-blur").style.backgroundImage="url("+i+")",this.fetching||(this.audio.src=n,fetch((0,r.lyricUrl)(t.songid)).then(function(e){return e.json()}).then(function(e){return e.lyric}).then(function(t){return e.lyric.init(t)}).catch(function(e){console.log(e)}).then(function(){return e.fetching=!1}),this.audio.play(),this.progress.init(t.duration),this.audio.volume=.3,this.show())}},{key:"createAudio",value:function(){var e=this,t=document.createElement("audio");return t.addEventListener("ended",function(){e.audio.play(),e.progress.init(),e.lyric.reset()}),document.body.appendChild(t),t}},{key:"event",value:function(e){var t=e.target;switch(t.id){case"pause-btn":this.onPause(t);break;case"play-btn":this.onPlay(t);break;case"hide-btn":this.hide()}}},{key:"onPlay",value:function(e){e.id="pause-btn",e.classList.remove("icon-play"),e.classList.add("icon-pause"),this.audio.play(),console.log("继续播放"),this.progress.play(),this.lyric.start()}},{key:"onPause",value:function(e){e.id="play-btn",e.classList.remove("icon-pause"),e.classList.add("icon-play"),this.audio.pause(),console.log("暂停播放"),this.progress.pause(),this.lyric.pause()}},{key:"show",value:function(){this.el.classList.add("show")}},{key:"hide",value:function(){this.el.classList.remove("show")}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.songUrl=function(e){return"http://ws.stream.qqmusic.qq.com/"+e+".m4a?fromtag=46"},t.lyricUrl=function(e){return"https://qq-music-api.now.sh/lyrics?id="+e},t.albumCoverUrl=function(e){return"https://y.gtimg.cn/music/photo_new/T002R150x150M000"+e+".jpg"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Progress=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.progressLoad=this.el.querySelector(".progress-load"),this.elapsed=this.el.querySelector(".elapsed-time"),this.duration=this.el.querySelector(".duration-time"),this.elapsedTime=0,this.durationTime=0,this.translate=0}return i(e,[{key:"init",value:function(e){clearInterval(this.intervalId),this.elapsedTime=0,this.progressLoad.style.transform="translateX(-100%)",e&&(this.durationTime=e,this.duration.innerHTML=this.formatTime(e)),this.intervalId=setInterval(this.update.bind(this),100)}},{key:"update",value:function(e){this.elapsedTime>=this.durationTime&&this.init(),this.elapsedTime+=.1,this.elapsed.innerHTML=this.formatTime(this.elapsedTime);var t=this.elapsedTime/this.durationTime*100-100;this.progressLoad.style.transform="translateX("+t+"%)"}},{key:"pause",value:function(){clearInterval(this.intervalId)}},{key:"play",value:function(){this.intervalId=setInterval(this.update.bind(this),100)}},{key:"formatTime",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Lyric=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.audio=n,this.lyric="",this.index=0,this.lineHeight=i||42}return i(e,[{key:"init",value:function(e){this.lyric=this.formatText(e).match(/^\[\d{2}:\d{2}.\d{2}\](.+)$/gm),this.render(this.lyric)}},{key:"reset",value:function(){this.index=0,this.el.style.transform="translateY(0px)",this.update()}},{key:"update",value:function(){var e=this;this.fn=function(){for(var e=this.index;e<this.lyricline.length;e++)Math.floor(this.audio.currentTime)===+this.lyricline[e].attributes["data-time"].value&&(this.lyricline[e].classList.add("lyric-current"),this.index=e,this.lyricline[e].previousElementSibling&&this.lyricline[e].previousElementSibling.classList.remove("lyric-current"));if(this.index>=4){var t=-(this.index-3)*this.lineHeight;this.el.style.transform="translateY("+t+"px)"}},this.audio.addEventListener("timeupdate",function(){return e.throttle(e.fn,e,500)})}},{key:"start",value:function(){var e=this;this.audio.addEventListener("timeupdate",function(){return e.throttle(e.fn,e,500)})}},{key:"pause",value:function(){var e=this;this.audio.removeEventListener("timeupdate",function(){return e.throttle(e.fn,e,500)})}},{key:"render",value:function(e){var t=this,n=e.map(function(e){return'<p data-time="'+t.getTimePoint(e.slice(1,9))+'">'+e.slice(10)+"</p>\n        "}).join("");this.el.innerHTML=n,this.lyricline=this.el.querySelectorAll("p"),this.update()}},{key:"getTimePoint",value:function(e){return e.replace(/(\d{2}):(\d{2}).\d{2}/,function(e,t,n){return 60*+t+ +n})}},{key:"formatText",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText}},{key:"throttle",value:function(e,t,n){var i=+new Date,r=i-this.pre;!this.pre||r>=n?(e.call(t),this.pre=i):this.pre&&r<n&&(clearTimeout(this.timer),this.timer=setTimeout(function(){return e.call(t)},n))}}]),e}()}]);